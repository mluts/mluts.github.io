{"version":3,"sources":["aw/router.cljs"],"mappings":";AAYA,qCAAA,rCAAKA;AACL,uCAAA,vCAAKC;AAEL,mBAAA,mFAAA,mFAAA,IAAA,2CAAA,qDAAA,kEAAA,wDAAA,iFAAA,+FAAA,qDAAA,6DAAA,AAAA,2FAAA,wCAAA,gDAAA,qDAAA,sDAAA,iEAAA,yDAAA,oDAAA,6DAAA,6DAAA,mDAAA,sDAAA,AAAA,mFAAA,AAAA,0DAAA,AAAA,yBAAA,AAAA,GAAA,AAAA,EAAA,AAAA,EAAA,AAAA,EAAA,AAAA,iDAAA,AAAA,KAAA,kBAAAC,wBAAA,AAAA,AAAAA,sCAAA,yBAAA,mFAAA,iBAAA,2CAAA,qDAAA,wDAAA,wDAAA,iFAAA,+FAAA,qDAAA,wDAAA,AAAA,gFAAA,wCAAA,gDAAA,qDAAA,sDAAA,iEAAA,yDAAA,oDAAA,6DAAA,6DAAA,mDAAA,sDAAA,AAAA,yEAAA,AAAA,0DAAA,AAAA,oBAAA,AAAA,GAAA,AAAA,EAAA,AAAA,EAAA,AAAA,EAAA,AAAA,iLAAA,AAAA,KAAA,kBAAAC,mBAAA,AAAA,AAAAA,iCAAA,yBAAA,mFAAA,UAAA,2CAAA,qDAAA,4DAAA,wDAAA,iFAAA,kGAAA,qDAAA,0DAAA,AAAA,oFAAA,wCAAA,gDAAA,qDAAA,sDAAA,iEAAA,yDAAA,oDAAA,6DAAA,6DAAA,mDAAA,sDAAA,AAAA,6EAAA,AAAA,0DAAA,AAAA,sBAAA,AAAA,GAAA,AAAA,EAAA,AAAA,GAAA,AAAA,GAAA,AAAA,iDAAA,AAAA,KAAA,kBAAAC,qBAAA,AAAA,AAAAA,mCAAA,yBAAA,mFAAA,UAAA,2CAAA,qDAAA,4DAAA,wDAAA,iFAAA,kGAAA,qDAAA,0DAAA,AAAA,oFAAA,wCAAA,gDAAA,qDAAA,sDAAA,iEAAA,yDAAA,oDAAA,6DAAA,6DAAA,mDAAA,sDAAA,AAAA,6EAAA,AAAA,0DAAA,AAAA,sBAAA,AAAA,GAAA,AAAA,EAAA,AAAA,GAAA,AAAA,GAAA,AAAA,iDAAA,AAAA,KAAA,kBAAAC,qBAAA,AAAA,AAAAA,mCAAA,/7MAAKC;AAqBL,AAAKC,mBACH,AAACC,qDAAUF;AAEb,GAAA,QAAAG,+BAAAC,sCAAAC;AAAA;AAAA,AAAA,AAASC,0BAAc,gDAAA,hDAACC;;AAExB,0BAAA,1BAAMC,4DAAeC;AAArB,AACE,OAACC,4DAAiBT,iBAAOQ;;AAE3B,uBAAA,vBAAME;AAAN,AACE,OAACC,iCACAX,iBACA,WAAKY;AAAL,AACE,GACE,EAAK,AAACC,cAAI,AAACC,yDAAkB,AAACC,6BAAeH,UACxC,AAACI;AACN,AACE,AAACC,sBAAOZ,wBAAc,AAACE,wBAAcd;;AACrC,AAACyB,gCAAazB;;AALlB,GAOE,AAACoB,cAAI,AAACC,yDAAkB,AAACC,6BAAeH;AACxC,AACE,AAACK,sBAAOZ,wBAAc,AAACE,wBAAcb;;AACrC,AAACwB,gCAAaxB;;AAVlB,AAaE,AAACuB,sBAAOZ,wBAAcO;;;;;AAExB,mBAAA,ZAACO,6BAAgCP;GAlBpC,2CAAA,sEAAA","names":["aw.router/default-authorized-route","aw.router/default-unauthorized-route","aw.view.frontpage/view","aw.view.game/view","aw.view.signin/view","aw.view.signup/view","aw.router/routes","aw.router/router","reitit.frontend.router","js/aw","js/aw.router","js/aw.router.current-match","aw.router/current-match","reagent.core.atom","aw.router/match-by-name","-name","reitit.frontend.match_by_name","aw.router/init!","reitit.frontend.easy/start!","m","cljs.core/not","aw.session.perms_ok_QMARK_","aw.route-helpers/route-perms","aw.session/authorized?","cljs.core/reset!","aw.route-helpers/redirect!","js/console.log"],"sourcesContent":["(ns aw.router\n  (:require\n   [reagent.core :as r]\n   [reitit.frontend :as rf]\n   [reitit.frontend.easy :as rfe]\n   [aw.session :as session]\n   [aw.route-helpers :as rh]\n   [aw.view.frontpage :as frontpage]\n   [aw.view.game :as game]\n   [aw.view.signin :as signin]\n   [aw.view.signup :as signup]))\n\n(def default-authorized-route :aw/frontpage)\n(def default-unauthorized-route :aw/signin)\n\n(def routes\n  [[\"/\"\n    {:name :aw/frontpage\n     :perms #{:authorized-only}\n     :view #'frontpage/view}]\n\n   [\"/game/:game_id\"\n    {:name :aw/game\n     :perms #{:authorized-only}\n     :view #'game/view}]\n\n   [\"/signin\"\n    {:name :aw/signin\n     :perms #{:unauthorized-only}\n     :view #'signin/view}]\n\n   [\"/signup\"\n    {:name :aw/signup\n     :perms #{:unauthorized-only}\n     :view #'signup/view}]])\n\n(def router\n  (rf/router routes))\n\n(defonce current-match (r/atom nil))\n\n(defn match-by-name [-name]\n  (rf/match-by-name router -name))\n\n(defn init! []\n  (rfe/start!\n   router\n   (fn [m]\n     (cond\n       (and (not (session/perms-ok? (rh/route-perms m)))\n            (session/authorized?))\n       (do\n         (reset! current-match (match-by-name default-authorized-route))\n         (rh/redirect! default-authorized-route))\n\n       (not (session/perms-ok? (rh/route-perms m)))\n       (do\n         (reset! current-match (match-by-name default-unauthorized-route))\n         (rh/redirect! default-unauthorized-route))\n\n       :else\n       (reset! current-match m))\n\n     (js/console.log \"Current route:\" m))\n\n   {:use-fragment true}))\n"]}